<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ…ë°©</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/chatting-room.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>

    </style>
</head>
<body>
<div id="app">
    <div id="wrapper">
        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div id="content">
            <!-- í—¤ë” -->
            <div class="content-header">
                <h1 class="room-title">ğŸ® ê²Œì„ í† í¬ë°©</h1>
                <div class="room-info">
                    <span>ğŸ‘¥ 5ëª… ì°¸ì—¬ì¤‘</span>
                    <span>ğŸ• ì˜¤í›„ 2:30 ì‹œì‘</span>
                    <span>ğŸ“ ê³µê°œë°©</span>
                </div>
            </div>

            <!-- ì±„íŒ… ë¡œê·¸ -->
            <div class="content-body">
                <div class="chat-messages">
                    <div class="message">
                        <div class="message-avatar">ê¹€</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">ê¹€ê²Œì´ë¨¸</span>
                                <span class="message-time">ì˜¤í›„ 2:31</span>
                            </div>
                            <div class="message-text">
                                ì•ˆë…•í•˜ì„¸ìš”! ë¡¤ ê°™ì´ í•˜ì‹¤ ë¶„ ê³„ì‹ ê°€ìš”?
                            </div>
                        </div>
                    </div>

                    <div class="message">
                        <div class="message-avatar">ë°•</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">ë°•í”„ë¡œ</span>
                                <span class="message-time">ì˜¤í›„ 2:32</span>
                            </div>
                            <div class="message-text">
                                ì € ì°¸ì—¬í•˜ê³  ì‹¶ì–´ìš”! í‹°ì–´ëŠ” ê³¨ë“œì…ë‹ˆë‹¤ ã…ã…
                            </div>
                        </div>
                    </div>

                    <div class="message own">
                        <div class="message-avatar">ë‚˜</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">ë‚˜</span>
                                <span class="message-time">ì˜¤í›„ 2:33</span>
                            </div>
                            <div class="message-text">
                                ì €ë„ ì°¸ì—¬í• ê²Œìš”! ì–¸ì œ ì‹œì‘í•˜ë‚˜ìš”?
                            </div>
                        </div>
                    </div>

                    <div class="message">
                        <div class="message-avatar">ì´</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-sender">ì´ìŠ¤í‚¬</span>
                                <span class="message-time">ì˜¤í›„ 2:34</span>
                            </div>
                            <div class="message-text">
                                5ë¶„ í›„ì— ì‹œì‘í•´ìš”! ë””ìŠ¤ì½”ë“œ ì£¼ì†Œ ë“œë¦´ê²Œìš”
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ì´ë“œë°” -->
        <div id="aside">
            <!-- ë‚´ ì •ë³´ -->
            <div class="aside-header">
                <div class="aside-header-content">
                    <div class="user-info">
                        <div class="user-avatar">ê¹€</div>
                        <div class="user-details">
                            <h3>ê¹€ì˜ˆì§„</h3>
                            <p>ë°©ì¥ â€¢ ì˜¨ë¼ì¸</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì°¸ì—¬ì ì •ë³´ -->
            <div class="aside-body">
                <h3 class="participants-title">
                    ğŸ‘¥ ì°¸ì—¬ì (5ëª…)
                </h3>
                <div class="participant-list">
                    <div class="participant">
                        <div class="participant-avatar">ê¹€</div>
                        <div class="participant-info">
                            <div class="participant-name">ê¹€ê²Œì´ë¨¸</div>
                            <div class="participant-status">ë°©ì¥</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>

                    <div class="participant">
                        <div class="participant-avatar">ë°•</div>
                        <div class="participant-info">
                            <div class="participant-name">ë°•í”„ë¡œ</div>
                            <div class="participant-status">ì°¸ì—¬ì</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>

                    <div class="participant">
                        <div class="participant-avatar">ì´</div>
                        <div class="participant-info">
                            <div class="participant-name">ì´ìŠ¤í‚¬</div>
                            <div class="participant-status">ì°¸ì—¬ì</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>

                    <div class="participant">
                        <div class="participant-avatar">ìµœ</div>
                        <div class="participant-info">
                            <div class="participant-name">ìµœê³ ìˆ˜</div>
                            <div class="participant-status">ì°¸ì—¬ì</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>

                    <div class="participant">
                        <div class="participant-avatar">ì •</div>
                        <div class="participant-info">
                            <div class="participant-name">ì •ë§ˆìŠ¤í„°</div>
                            <div class="participant-status">ì°¸ì—¬ì</div>
                        </div>
                        <div class="online-indicator"></div>
                    </div>
                </div>
            </div>

            <!-- ë‚˜ê°€ê¸° ë²„íŠ¼ -->
            <div class="aside-footer">
                <button class="leave-btn">ğŸšª ì±„íŒ…ë°© ë‚˜ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì±„íŒ… ì…ë ¥ -->
    <div id="footer">
        <div class="chat-input-container">
            <input type="text" class="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." maxlength="500">
            <button class="send-btn">
                <svg viewBox="0 0 24 24">
                    <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<script>
    const roomId = window.location.pathname.split('/').pop(); // ë°© id ì¶”ì¶œ
    const chatWs = new WebSocket(`ws://localhost:8888/chat/joinRoom/${roomId}`); // ì±„íŒ…ë°© ì›¹ì†Œì¼“

    chatWs.onmessage=(e)=>{
        const data = JSON.parse(e.data);
    }


    // ì…ë ¥ì°½ í¬ì»¤ìŠ¤ íš¨ê³¼
    const chatInput = document.querySelector('.chat-input');
    const inputContainer = document.querySelector('.chat-input-container');

    chatInput.addEventListener('focus', () => {
        inputContainer.classList.add('focused');
    });

    chatInput.addEventListener('blur', () => {
        inputContainer.classList.remove('focused');
    });

    // ì—”í„°í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    // ì „ì†¡ ë²„íŠ¼ í´ë¦­
    document.querySelector('.send-btn').addEventListener('click', sendMessage);

    function sendMessage() {
        const message = chatInput.value.trim();
        if (message) {
            console.log('ë©”ì‹œì§€ ì „ì†¡:', message);
            chatInput.value = '';

            // ì—¬ê¸°ì— ì‹¤ì œ ë©”ì‹œì§€ ì „ì†¡ ë¡œì§ ì¶”ê°€
            addMessage(message, true);
        }
    }

    // ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
    function addMessage(text, isOwn = false) {
        const messagesContainer = document.querySelector('.chat-messages');
        const now = new Date();
        const timeString = now.toLocaleTimeString('ko-KR', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
        });

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isOwn ? 'own' : ''}`;

        messageDiv.innerHTML = `
                <div class="message-avatar">${isOwn ? 'ë‚˜' : 'ê¹€'}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">${isOwn ? 'ë‚˜' : 'ê¹€ê²Œì´ë¨¸'}</span>
                        <span class="message-time">${timeString}</span>
                    </div>
                    <div class="message-text">${text}</div>
                </div>
            `;

        messagesContainer.appendChild(messageDiv);

        // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
        document.querySelector('.content-body').scrollTop =
            document.querySelector('.content-body').scrollHeight;
    }

    // ë‚˜ê°€ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
    document.querySelector('.leave-btn').addEventListener('click', () => {
        if (confirm('ì •ë§ ì±„íŒ…ë°©ì„ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            window.location.href = '/chat/main';
        }
    });
</script>
</body>
</html>